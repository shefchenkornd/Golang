# Go Modules
начиная с версии 1.11 появилась поддержка модулей -  системы версионирования и зависимостей, а также разработка вне GOPATH.

Стандартные команды (go get, go instsll, go test и тд) работаю по разному внутри моделуй и внутри GOPATH.

Модуль - это любая директтория вне `GOPATH`, содержащая файл `go.mod`

## Создание Go модуля

* (опционально) создайте или склонируйте репо в любое место
git clone https:github.com/user/otus-go.git /work/golang/otus-go

* создаем внутри репо нужные директории
mkdir /work/golang/otus-go/hw-1

* зайдите в директорию  и инициализируйте Go модуль
cd /work/golang/otus-go/hw-1

go mod init github.com/user/otus-go/hw-1
<github.com/user/otus-go/hw-1> - это имя будут впоследствии использовать другие пользователи при импорте


## Добавление зависимостей

внутри модуля. вы так можете добавить пакет точно так же
`go get github.com/beevik/ntp`

Но при этом пакет попадет не в `GOPATH/src`, а в `GOPATH/pkg/mod` причем с указанием КОНКРЕТНОЙ ВЕРСИИ на момент скачивания

v.0.2.0
первая цифра - это мажорная версия, когда ломается api и нет обратной совместимости
вторая цифра - когда добавляется новый функционал, но есть обратная совместимость
третья цифра - когда ничего не поменялось в api, а поменялись только внутренние алгоритмы, оптимизация.

## Авто-добавление зависимостями

редактируйте код своих исходных файлов, а потом запустите

go mod tidy

это добавит новые и удалит неиспользуемые зависимости


## Получение справки
go help build


## Форматирование кода
go fmt path/code.go

## Линтеры - программа, анализирующая код и сообщающая о потенциальных проблемах

`go vet path/code.go` - встроенный линтер

`golint` - популярный сторонний линтер

скачиваем линтер
`go get  -u golang.org/x/lint/golint`

`~/go/bin/golint -set_exit_status /code.go`

 Каждый линтер возвращает код выхода 
 `echo $?`
 это можно использовать при разработке bash-скриптов

## Металинтеры
### - это обёртка, запускающая несколько линтеров за один проход

`go get github.com/golangci/golangci-lint/cmd/golangci-lint@v1.27.0`

`~/go/bin/golangci-lint run code.go`

`echo $?`

## Тестирование
Особые суффиксы файлов
* _386б _amd64 -  только для указанной арх-ры
* _linux, _windows -  только для указанной OS
* _test - тесты для пакета


Важно:
* `package`  тот же что и в основном коде
* Все тесты - экспортируемые функции, начинающиеся с букв `Test`
* Тесты принимают `t` - API для установки результата тестирования

### Запуск тестов
`go test`

Тест произвольного пакета
`go test github.com/gorilla/mux`

Тест вместе с вложенными пакетами
`go test google.golang.org/grpc/...`

## Пакет `testing`
t.Fail()        // отметить тест как сломанный, но продолжит выполнение
t.FailNow()     // отметить тест как сломанный и прекратить текущий тест
t.Logf()        // вывести сообщение с отладкой
t.Errorf()      // t.Logf + t.Fail
t.Fatalf()      // t.Logf + t.FailNow
t.SkipNow()     // пропустить тест

Рекомендую пакет `github.com/stretchr/testify`

## Best prictices тестирования
* Тесты д.б. достоверными и исчерпывающими
* Тесты - это тоже код
* Один тест - один тестовый случай
* Тесты должны быть изолированы (нет веерных поломок)
* Тесты должны отрабатывать быстро
